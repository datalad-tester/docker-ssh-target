<VirtualHost *:80>
    Protocols h2 h2c http/1.1

    ServerAdmin a.remove.me.waite@fz-juelich.de
    ServerName store1.tests.datalad.org

    # This cries for a "don't touch" style comment
    RewriteEngine on
    RewriteRule ^ https://store1.tests.datalad.org:4430%{REQUEST_URI} [L,NE,R=temp]

    # Possible values include: debug, info, notice, warn, error, crit, alert, emerg.
    LogLevel warn

    ErrorLog ${APACHE_LOG_DIR}/store1.tests.datalad.org.error.log
    CustomLog ${APACHE_LOG_DIR}/store1.tests.datalad.org.access.log combined

    ServerSignature Off
</VirtualHost>

<IfModule mod_ssl.c>
<VirtualHost *:443>
    Protocols h2 h2c http/1.1

    ServerAdmin a.remove.me.waite@fz-juelich.de
    ServerName store1.tests.datalad.org

    DocumentRoot /ds/store1/srv

    SetEnv GIT_PROJECT_ROOT /ds/store1/srv
    SetEnv GIT_HTTP_EXPORT_ALL

    KeepAlive On
    KeepAliveTimeout 10
    MaxKeepAliveRequests 0

    <Directory /ds/store1/srv>
        Options +Indexes +FollowSymLinks
        AllowOverride None

        AuthType Basic
        AuthName "store1"
        AuthBasicProvider file
        AuthUserFile "/ds/store1/htpasswd"
        Require valid-user
    </Directory>

    # Possible values include: debug, info, notice, warn, error, crit, alert, emerg.
    LogLevel warn

    ErrorLog ${APACHE_LOG_DIR}/store1.tests.datalad.org.error.log
    CustomLog ${APACHE_LOG_DIR}/store1.tests.datalad.org.access.log combined

    ServerSignature Off

    SSLCertificateFile /etc/ssl/certs/store1.pem
    SSLCertificateKeyFile /etc/ssl/private/store1.pem

    # SSL config stolen from certbot config
    SSLEngine on

    # Intermediate configuration, tweak to your needs
    SSLProtocol             all -SSLv2 -SSLv3
    SSLCipherSuite          ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS
    SSLHonorCipherOrder     on
    SSLCompression          off

    SSLOptions +StrictRequire

</VirtualHost>
</IfModule>

